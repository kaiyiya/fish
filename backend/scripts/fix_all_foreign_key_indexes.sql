-- 修复所有外键索引冲突的脚本
-- 问题：TypeORM 的 synchronize 试图删除被外键约束使用的索引
-- 解决方案：删除外键约束 -> 删除重复索引 -> 重新创建外键约束（MySQL 会自动创建索引）

-- Cart 表
ALTER TABLE cart DROP FOREIGN KEY IF EXISTS FK_371eb56ecc4104c2644711fa85f;
ALTER TABLE cart DROP FOREIGN KEY IF EXISTS FK_756f53ab9466eb52a52619ee019;
DROP INDEX IF EXISTS IDX_371eb56ecc4104c2644711fa85 ON cart;
DROP INDEX IF EXISTS IDX_756f53ab9466eb52a52619ee019 ON cart;
ALTER TABLE cart ADD CONSTRAINT FK_371eb56ecc4104c2644711fa85f FOREIGN KEY (productId) REFERENCES fish_product(id);
ALTER TABLE cart ADD CONSTRAINT FK_756f53ab9466eb52a52619ee019 FOREIGN KEY (userId) REFERENCES user(id);

-- Favorite 表
ALTER TABLE favorite DROP FOREIGN KEY IF EXISTS FK_83b775fdebbe24c29b2b5831f2d;
ALTER TABLE favorite DROP FOREIGN KEY IF EXISTS FK_b8e337759b77baa0a4055d1894e;
DROP INDEX IF EXISTS IDX_83b775fdebbe24c29b2b5831f2 ON favorite;
DROP INDEX IF EXISTS IDX_b8e337759b77baa0a4055d1894 ON favorite;
ALTER TABLE favorite ADD CONSTRAINT FK_83b775fdebbe24c29b2b5831f2d FOREIGN KEY (userId) REFERENCES user(id);
ALTER TABLE favorite ADD CONSTRAINT FK_b8e337759b77baa0a4055d1894e FOREIGN KEY (productId) REFERENCES fish_product(id);

-- Review 表
ALTER TABLE review DROP FOREIGN KEY IF EXISTS FK_1337f93918c70837d3cea105d39;
ALTER TABLE review DROP FOREIGN KEY IF EXISTS FK_2a11d3c0ea1b2b5b1790f762b9a;
ALTER TABLE review DROP FOREIGN KEY IF EXISTS FK_31db76b2d6dfe81d69e27b66c20;
DROP INDEX IF EXISTS IDX_1337f93918c70837d3cea105d3 ON review;
DROP INDEX IF EXISTS IDX_2a11d3c0ea1b2b5b1790f762b9 ON review;
ALTER TABLE review ADD CONSTRAINT FK_1337f93918c70837d3cea105d39 FOREIGN KEY (userId) REFERENCES user(id);
ALTER TABLE review ADD CONSTRAINT FK_2a11d3c0ea1b2b5b1790f762b9a FOREIGN KEY (productId) REFERENCES fish_product(id);
ALTER TABLE review ADD CONSTRAINT FK_31db76b2d6dfe81d69e27b66c20 FOREIGN KEY (orderId) REFERENCES `order`(id);

-- 注意：执行此脚本后，MySQL 会自动为外键创建索引
-- 这些索引不会被 TypeORM 的 synchronize 删除，因为它们是由外键约束自动创建的
