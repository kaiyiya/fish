# 快速开始训练指南

## 环境信息
- **Conda环境路径**: `D:\Anaconda\envs\pytorch`
- **训练脚本**: `train_pytorch.py`
- **数据集目录**: `data/fish_images/`

## 已调整的训练参数

```python
BATCH_SIZE = 16      # 降低批次大小，适应较小数据集
EPOCHS = 20          # 减少训练轮数，快速测试
NUM_WORKERS = 2      # Windows适配
```

## 一键训练（推荐）

直接双击运行：
```
训练.bat
```

这个脚本会自动：
1. ✅ 检查并激活Conda环境
2. ✅ 检查PyTorch是否安装
3. ✅ 准备数据集目录
4. ✅ 检查数据集是否存在
5. ✅ 开始训练

## 手动训练步骤

### 1. 准备数据集

运行数据集准备脚本：
```bash
cd backend/src/modules/ai/training
D:\Anaconda\envs\pytorch\python.exe download_fish_dataset.py
```

这会创建以下目录结构：
```
data/
└── fish_images/
    ├── salmon/        # 三文鱼
    ├── sea_bass/     # 鲈鱼
    ├── tuna/         # 金枪鱼
    ├── carp/         # 鲤鱼
    ├── trout/        # 鳟鱼
    ├── cod/          # 鳕鱼
    ├── mackerel/     # 鲭鱼
    └── sardine/      # 沙丁鱼
```

### 2. 添加图片数据

**方法1：从Kaggle下载（推荐）**
- 访问：https://www.kaggle.com/datasets/crowww/a-large-scale-fish-dataset
- 下载数据集后，按类别整理到对应文件夹
- 每类至少准备 20-50 张图片

**方法2：自己收集**
- 使用搜索引擎搜索各类鱼类图片
- 下载后按类别放入对应文件夹
- 图片格式：jpg, jpeg, png

**方法3：快速测试（最少数据）**
- 每类准备 10-20 张图片即可开始测试训练
- 后续可以逐步增加数据量

### 3. 开始训练

**使用批处理文件（最简单）：**
```bash
训练.bat
```

**或手动运行：**
```bash
cd backend/src/modules/ai/training
D:\Anaconda\envs\pytorch\python.exe train_pytorch.py
```

## 训练过程

训练时会显示：
```
Epoch [ 1/20] | Train: Loss=1.2345 Acc=0.5678 | Val: Loss=1.1234 Acc=0.6789
   ✅ 保存更优模型 (Val Acc = 0.6789)
```

训练完成后会生成：
- `models/fish_classifier_resnet18.pth` - 模型权重
- `models/class_to_idx.pt` - 类别映射

## 训练完成后

1. **重启后端服务**（如果正在运行）
2. **测试识别功能**：
   - 在前端上传鱼类图片
   - 查看识别结果
   - 应该不再是固定的"三文鱼"了

## 参数调整

如果需要调整训练参数，编辑 `train_pytorch.py`：

```python
BATCH_SIZE = 16      # 批次大小（内存不足时减小）
EPOCHS = 20          # 训练轮数（数据多时可以增加）
LEARNING_RATE = 1e-4 # 学习率（一般不需要改）
```

## 常见问题

### Q: 训练时提示"数据目录不存在"
A: 先运行 `download_fish_dataset.py` 创建目录结构

### Q: 训练很慢
A: 
- 减少 `EPOCHS`（先用10轮测试）
- 如果有GPU会自动使用，CPU训练会慢一些

### Q: 内存不足
A: 减小 `BATCH_SIZE`（改为8或4）

### Q: 识别效果不好
A:
- 增加每类的图片数量（建议每类100+张）
- 增加训练轮数
- 检查图片质量

## 验证训练是否成功

训练完成后检查：
1. `models/fish_classifier_resnet18.pth` 文件是否存在
2. `models/class_to_idx.pt` 文件是否存在
3. 文件大小应该 > 0（通常几十MB）

如果文件存在，重启后端后识别功能就会使用训练好的模型！
