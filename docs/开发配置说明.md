# 开发配置说明

## 一、需要安装的依赖

### 后端依赖

在 `backend` 目录下运行：

```bash
cd backend
npm install
```

**需要额外安装的依赖：**

```bash
# 文件上传相关
npm install multer @types/multer

# 如果需要使用uuid（已改用crypto，不需要）
# npm install uuid @types/uuid
```

### 前端依赖

在 `frontend` 目录下运行：

```bash
cd frontend
npm install
```

前端依赖已经完整，无需额外安装。

---

## 二、环境变量配置

### 后端环境变量

在 `backend` 目录下创建 `.env` 文件（参考 `.env.example`）：

```env
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_password
DB_DATABASE=fish_app

# JWT配置
JWT_SECRET=your_jwt_secret_key_here_change_in_production
JWT_EXPIRES_IN=7d

# 应用配置
NODE_ENV=development
PORT=3000
BASE_URL=http://localhost:3000

# 文件上传配置
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=5242880
ALLOWED_FILE_TYPES=jpg,jpeg,png

# AI模型配置
MODEL_PATH=./models/fish_classifier.h5
MODEL_CONFIDENCE_THRESHOLD=0.5

# Redis配置（可选）
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# 前端地址（CORS配置）
FRONTEND_URL=http://localhost:10086
```

### 前端环境变量

在 `frontend` 目录下创建 `.env` 文件（如果需要）：

```env
TARO_APP_API_URL=http://localhost:3000
```

或者在 `config/dev.ts` 中配置：

```typescript
export default {
  env: {
    TARO_APP_API_URL: 'http://localhost:3000'
  }
}
```

---

## 三、数据库配置

### 1. 创建数据库

运行 `scripts/init.sql` 创建数据库：

```sql
CREATE DATABASE IF NOT EXISTS fish_app 
  DEFAULT CHARACTER SET utf8mb4 
  DEFAULT COLLATE utf8mb4_unicode_ci;
```

### 2. 数据库表

系统使用 TypeORM 的 `synchronize` 功能自动创建表（开发环境）。

**注意：** 生产环境请关闭 `synchronize`，使用迁移脚本。

---

## 四、目录结构

### 需要创建的目录

```bash
# 后端上传目录
mkdir -p backend/uploads

# AI模型目录（如果需要）
mkdir -p backend/models
```

---

## 五、启动服务

### 后端启动

```bash
cd backend
npm run start:dev
```

后端服务运行在：`http://localhost:3000`

### 前端启动

```bash
cd frontend
# 微信小程序
npm run dev:weapp

# H5
npm run dev:h5
```

---

## 六、已实现的功能

### ✅ 后端功能

1. **用户认证模块**
   - 用户注册
   - 用户登录
   - JWT Token 认证

2. **用户管理模块**
   - 获取用户信息
   - 更新用户信息

3. **商品管理模块**
   - 商品CRUD
   - 商品搜索
   - 用户行为记录（浏览）

4. **订单管理模块**
   - 订单创建
   - 订单查询
   - 购买行为记录

5. **AI模块**
   - 图像识别接口
   - 推荐接口（多种算法）

6. **搜索模块**
   - 关键词搜索
   - 搜索日志记录
   - 热门搜索关键词

7. **统计模块**
   - 识别统计
   - 推荐统计
   - 销售统计

8. **上传模块**（新增）
   - 图片上传
   - 文件验证
   - 静态文件服务

### ✅ 前端功能

1. **首页**
   - 商品列表
   - 推荐商品展示

2. **识别页面**
   - 图片选择
   - 图片上传
   - 识别结果展示

3. **商品页面**
   - 商品列表
   - 商品详情

4. **搜索页面**
   - 关键词搜索

5. **订单页面**
   - 订单列表
   - 订单详情

6. **个人中心**
   - 用户信息展示

---

## 七、待完善的功能

### 可选功能（根据需求）

1. **购物车功能**
   - 添加购物车
   - 购物车管理
   - 购物车结算

2. **收藏功能**
   - 商品收藏
   - 收藏列表

3. **评价功能**
   - 商品评价
   - 评价展示

4. **地址管理**
   - 收货地址管理

5. **支付功能**
   - 订单支付（集成支付接口）

---

## 八、API接口说明

### 认证接口

- `POST /auth/register` - 用户注册
- `POST /auth/login` - 用户登录

### 用户接口

- `GET /user/profile` - 获取用户信息（需认证）
- `PATCH /user/profile` - 更新用户信息（需认证）

### 商品接口

- `GET /product` - 获取商品列表
- `GET /product/:id` - 获取商品详情（需认证，会记录浏览行为）

### 订单接口

- `POST /order` - 创建订单（需认证）
- `GET /order` - 获取订单列表（需认证）
- `GET /order/:id` - 获取订单详情（需认证）

### AI接口

- `POST /ai/recognize` - 图像识别（需认证）
- `GET /ai/recommend` - 获取推荐（需认证）

### 搜索接口

- `GET /search` - 搜索商品
- `GET /search/hot` - 获取热门搜索

### 统计接口

- `GET /statistics/recognition` - 识别统计
- `GET /statistics/recommendation` - 推荐统计
- `GET /statistics/sales` - 销售统计

### 上传接口

- `POST /upload` - 上传文件（需认证）

---

## 九、常见问题

### 1. 图片上传失败

- 检查 `uploads` 目录是否存在
- 检查文件大小是否超过限制（默认5MB）
- 检查文件类型是否支持（jpg, jpeg, png）

### 2. 数据库连接失败

- 检查数据库是否启动
- 检查 `.env` 文件中的数据库配置
- 检查数据库用户权限

### 3. JWT认证失败

- 检查 `.env` 文件中的 `JWT_SECRET` 配置
- 检查请求头中是否包含 `Authorization: Bearer <token>`

### 4. CORS跨域问题

- 检查 `main.ts` 中的 CORS 配置
- 检查前端请求地址是否正确

---

## 十、下一步工作

1. **完善前端页面**
   - 完善订单创建流程
   - 完善搜索页面功能
   - 添加加载状态和错误处理

2. **AI模型集成**
   - 训练鱼类识别模型
   - 集成模型到识别服务

3. **推荐算法优化**
   - 优化推荐算法性能
   - 添加推荐结果缓存

4. **测试**
   - 单元测试
   - 集成测试
   - 性能测试

---

## 十一、联系与支持

如有问题，请查看：
- 项目 README.md
- 后端 README.md
- 前端 README.md
- 算法文档：`backend/src/modules/ai/README-推荐算法.md`
