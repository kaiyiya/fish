# 智能鱼类电商推荐系统 - 系统图表

本文档包含系统的用例图、架构图、ER图和重要功能流程图。

## 工具推荐

### 1. Mermaid（推荐）
- **优点**：代码生成图表，易于维护和版本控制
- **使用**：VS Code安装Mermaid插件，或使用在线编辑器 https://mermaid.live/
- **导出**：可导出为PNG、SVG格式

### 2. PlantUML
- **优点**：专业的UML工具，支持多种图表类型
- **使用**：VS Code安装PlantUML插件
- **导出**：可导出为PNG、SVG、PDF格式

### 3. Draw.io / diagrams.net
- **优点**：在线绘图工具，界面友好
- **使用**：访问 https://app.diagrams.net/
- **导出**：支持多种格式导出

### 4. Lucidchart
- **优点**：专业图表工具，模板丰富
- **使用**：在线使用，需要注册
- **导出**：支持多种格式

---

## 1. 用例图（Use Case Diagram）

### Mermaid格式

```mermaid
graph TB
    User[普通用户] --> UC1[用户注册]
    User --> UC2[用户登录]
    User --> UC3[浏览商品]
    User --> UC4[搜索商品]
    User --> UC5[查看商品详情]
    User --> UC6[添加购物车]
    User --> UC7[管理购物车]
    User --> UC8[创建订单]
    User --> UC9[查看订单]
    User --> UC10[管理收货地址]
    User --> UC11[图像识别]
    User --> UC12[查看推荐商品]
    User --> UC13[收藏商品]
    User --> UC14[商品评价]
    User --> UC15[查看个人中心]
    
    Admin[管理员] --> UC16[商品管理]
    Admin --> UC17[分类管理]
    Admin --> UC18[订单管理]
    Admin --> UC19[用户管理]
    Admin --> UC20[数据统计]
    
    System[系统] --> UC21[记录用户行为]
    System --> UC22[生成推荐]
    System --> UC23[发送通知]
```

### PlantUML格式

```plantuml
@startuml
left to right direction

actor "普通用户" as User
actor "管理员" as Admin
actor "系统" as System

rectangle "智能鱼类电商推荐系统" {
    User --> (用户注册)
    User --> (用户登录)
    User --> (浏览商品)
    User --> (搜索商品)
    User --> (查看商品详情)
    User --> (添加购物车)
    User --> (管理购物车)
    User --> (创建订单)
    User --> (查看订单)
    User --> (管理收货地址)
    User --> (图像识别)
    User --> (查看推荐商品)
    User --> (收藏商品)
    User --> (商品评价)
    User --> (查看个人中心)
    
    Admin --> (商品管理)
    Admin --> (分类管理)
    Admin --> (订单管理)
    Admin --> (用户管理)
    Admin --> (数据统计)
    
    System --> (记录用户行为)
    System --> (生成推荐)
    System --> (发送通知)
}

@enduml
```

---

## 2. 系统架构图（Architecture Diagram）

### Mermaid格式

```mermaid
graph TB
    subgraph "前端层 Frontend"
        A1[Taro小程序/H5]
        A2[React组件]
        A3[状态管理Zustand]
        A4[API调用Axios]
    end
    
    subgraph "API网关层"
        B1[NestJS RESTful API]
        B2[JWT认证]
        B3[请求拦截器]
    end
    
    subgraph "业务逻辑层"
        C1[用户模块]
        C2[商品模块]
        C3[订单模块]
        C4[购物车模块]
        C5[地址模块]
        C6[评价模块]
        C7[收藏模块]
    end
    
    subgraph "AI服务层"
        D1[图像识别服务]
        D2[推荐算法服务]
        D3[协同过滤算法]
        D4[基于内容推荐]
    end
    
    subgraph "数据访问层"
        E1[TypeORM]
        E2[数据访问对象]
    end
    
    subgraph "数据存储层"
        F1[MySQL数据库]
        F2[Redis缓存]
    end
    
    A1 --> A2
    A2 --> A3
    A3 --> A4
    A4 --> B1
    B1 --> B2
    B2 --> B3
    B3 --> C1
    B3 --> C2
    B3 --> C3
    B3 --> C4
    B3 --> C5
    B3 --> C6
    B3 --> C7
    C2 --> D1
    C2 --> D2
    D2 --> D3
    D2 --> D4
    C1 --> E1
    C2 --> E1
    C3 --> E1
    C4 --> E1
    C5 --> E1
    C6 --> E1
    C7 --> E1
    E1 --> E2
    E2 --> F1
    E2 --> F2
```

### 分层架构图（更详细）

```mermaid
graph LR
    subgraph "表现层 Presentation Layer"
        P1[微信小程序]
        P2[H5网页]
    end
    
    subgraph "应用层 Application Layer"
        A1[用户服务]
        A2[商品服务]
        A3[订单服务]
        A4[推荐服务]
        A5[识别服务]
    end
    
    subgraph "领域层 Domain Layer"
        D1[用户实体]
        D2[商品实体]
        D3[订单实体]
        D4[行为实体]
    end
    
    subgraph "基础设施层 Infrastructure Layer"
        I1[数据库访问]
        I2[文件存储]
        I3[缓存服务]
        I4[AI模型服务]
    end
    
    P1 --> A1
    P1 --> A2
    P1 --> A3
    P1 --> A4
    P1 --> A5
    P2 --> A1
    P2 --> A2
    P2 --> A3
    P2 --> A4
    P2 --> A5
    
    A1 --> D1
    A2 --> D2
    A3 --> D3
    A4 --> D4
    A5 --> D2
    
    D1 --> I1
    D2 --> I1
    D3 --> I1
    D4 --> I1
    
    A2 --> I2
    A4 --> I3
    A5 --> I4
```

---

## 3. ER图（Entity Relationship Diagram）

### Mermaid格式

```mermaid
erDiagram
    USER ||--o{ ORDER : "创建"
    USER ||--o{ CART : "拥有"
    USER ||--o{ FAVORITE : "收藏"
    USER ||--o{ ADDRESS : "拥有"
    USER ||--o{ USER_BEHAVIOR : "产生"
    USER ||--o{ REVIEW : "评价"
    USER ||--o{ USER_COUPON : "拥有"
    
    PRODUCT ||--o{ ORDER_ITEM : "包含"
    PRODUCT ||--o{ CART : "加入"
    PRODUCT ||--o{ FAVORITE : "被收藏"
    PRODUCT ||--o{ REVIEW : "被评价"
    PRODUCT ||--o{ USER_BEHAVIOR : "被浏览"
    PRODUCT }o--|| CATEGORY : "属于"
    
    ORDER ||--o{ ORDER_ITEM : "包含"
    ORDER }o--|| ADDRESS : "使用"
    
    CATEGORY ||--o{ PRODUCT : "分类"
    
    COUPON ||--o{ USER_COUPON : "被领取"
    
    USER {
        int id PK
        string username UK
        string password
        string phone UK
        string avatar
        string gender
        int age
        string role
        datetime created_at
        datetime updated_at
    }
    
    PRODUCT {
        int id PK
        string name
        int categoryId FK
        decimal price
        int stock
        text description
        json imageUrls
        text nutritionInfo
        text cookingTips
        int freshnessLevel
        datetime created_at
        datetime updated_at
    }
    
    ORDER {
        int id PK
        int userId FK
        int addressId FK
        decimal totalAmount
        string status
        datetime created_at
        datetime updated_at
    }
    
    ORDER_ITEM {
        int id PK
        int orderId FK
        int productId FK
        int quantity
        decimal price
    }
    
    CART {
        int id PK
        int userId FK
        int productId FK
        int quantity
        datetime created_at
    }
    
    CATEGORY {
        int id PK
        string name
        int parentId FK
        string icon
        int sortOrder
        datetime created_at
    }
    
    ADDRESS {
        int id PK
        int userId FK
        string name
        string phone
        string province
        string city
        string district
        string detail
        boolean isDefault
        datetime created_at
    }
    
    FAVORITE {
        int id PK
        int userId FK
        int productId FK
        datetime created_at
    }
    
    REVIEW {
        int id PK
        int userId FK
        int productId FK
        int rating
        text content
        datetime created_at
    }
    
    USER_BEHAVIOR {
        int id PK
        int userId FK
        int productId FK
        string behaviorType
        float behaviorValue
        datetime created_at
    }
    
    COUPON {
        int id PK
        string name
        string type
        decimal discount
        datetime startTime
        datetime endTime
        int totalCount
        int usedCount
    }
    
    USER_COUPON {
        int id PK
        int userId FK
        int couponId FK
        string status
        datetime usedTime
        datetime created_at
    }
```

---

## 4. 重要功能流程图

### 4.1 图像识别流程图

```mermaid
flowchart TD
    Start([用户选择图片]) --> Upload[上传图片到服务器]
    Upload --> Validate{验证图片格式}
    Validate -->|格式错误| Error1[返回错误信息]
    Validate -->|格式正确| Preprocess[图片预处理]
    Preprocess --> LoadModel[加载MobileNetV3模型]
    LoadModel --> Predict[模型推理预测]
    Predict --> GetResult[获取识别结果]
    GetResult --> SaveLog[保存识别记录]
    SaveLog --> GetProducts[根据识别结果查询商品]
    GetProducts --> Return[返回识别结果和推荐商品]
    Return --> End([结束])
    Error1 --> End
```

### 4.2 智能推荐流程图

```mermaid
flowchart TD
    Start([用户请求推荐]) --> CheckBehavior{检查用户行为数据}
    CheckBehavior -->|行为数据充足| UserCF[基于用户的协同过滤]
    CheckBehavior -->|行为数据不足| ContentBased[基于内容的推荐]
    UserCF --> CalcSimilarity[计算用户相似度]
    CalcSimilarity --> FindSimilarUsers[找到相似用户]
    FindSimilarUsers --> GetProducts[获取相似用户喜欢的商品]
    GetProducts --> ItemCF[基于物品的协同过滤]
    ItemCF --> CalcItemSimilarity[计算商品相似度]
    CalcItemSimilarity --> Hybrid[混合推荐策略]
    ContentBased --> BuildProfile[构建用户画像]
    BuildProfile --> MatchProducts[匹配商品特征]
    MatchProducts --> Hybrid
    Hybrid --> WeightedScore[加权融合得分]
    WeightedScore --> Sort[排序推荐结果]
    Sort --> Filter[过滤已购买商品]
    Filter --> Return[返回Top-N推荐]
    Return --> SaveLog[保存推荐日志]
    SaveLog --> End([结束])
```

### 4.3 订单创建流程图

```mermaid
flowchart TD
    Start([用户点击结算]) --> CheckLogin{检查登录状态}
    CheckLogin -->|未登录| Redirect[跳转登录页]
    CheckLogin -->|已登录| GetCart[获取购物车商品]
    GetCart --> ValidateStock{验证库存}
    ValidateStock -->|库存不足| Error1[返回库存不足提示]
    ValidateStock -->|库存充足| GetAddress[获取收货地址]
    GetAddress --> CheckAddress{检查地址是否存在}
    CheckAddress -->|不存在| Error2[提示选择地址]
    CheckAddress -->|存在| CalcTotal[计算订单总金额]
    CalcTotal --> CreateOrder[创建订单]
    CreateOrder --> CreateItems[创建订单项]
    CreateItems --> UpdateStock[更新商品库存]
    UpdateStock --> ClearCart[清空购物车]
    ClearCart --> RecordBehavior[记录购买行为]
    RecordBehavior --> Return[返回订单信息]
    Return --> End([结束])
    Error1 --> End
    Error2 --> End
    Redirect --> End
```

### 4.4 用户注册登录流程图

```mermaid
flowchart TD
    Start([用户访问系统]) --> CheckToken{检查Token}
    CheckToken -->|Token有效| LoggedIn[已登录状态]
    CheckToken -->|Token无效/不存在| ShowLogin[显示登录页]
    ShowLogin --> UserInput[用户输入账号密码]
    UserInput --> Validate{验证输入}
    Validate -->|验证失败| ShowError[显示错误信息]
    Validate -->|验证成功| CheckUser{检查用户是否存在}
    CheckUser -->|不存在| ShowRegister[显示注册页]
    CheckUser -->|存在| VerifyPassword{验证密码}
    VerifyPassword -->|密码错误| ShowError
    VerifyPassword -->|密码正确| GenerateToken[生成JWT Token]
    ShowRegister --> RegisterInput[用户输入注册信息]
    RegisterInput --> ValidateRegister{验证注册信息}
    ValidateRegister -->|验证失败| ShowError
    ValidateRegister -->|验证成功| CheckDuplicate{检查用户名/手机号}
    CheckDuplicate -->|已存在| ShowError
    CheckDuplicate -->|不存在| HashPassword[加密密码]
    HashPassword --> CreateUser[创建用户]
    CreateUser --> GenerateToken
    GenerateToken --> SaveToken[保存Token到本地]
    SaveToken --> LoggedIn
    LoggedIn --> End([进入系统])
    ShowError --> UserInput
```

---

## 5. 推荐算法流程图（详细版）

```mermaid
flowchart TD
    Start([推荐请求]) --> GetUserBehavior[获取用户行为数据]
    GetUserBehavior --> CheckData{数据量检查}
    CheckData -->|数据量<阈值| ColdStart[冷启动处理]
    CheckData -->|数据量>=阈值| WarmStart[正常推荐]
    
    ColdStart --> PopularItems[热门商品推荐]
    ColdStart --> CategoryBased[基于分类推荐]
    PopularItems --> Return1[返回推荐结果]
    CategoryBased --> Return1
    
    WarmStart --> UserCF[UserCF算法]
    WarmStart --> ItemCF[ItemCF算法]
    WarmStart --> ContentBased[Content-Based算法]
    
    UserCF --> BuildUserMatrix[构建用户-商品矩阵]
    BuildUserMatrix --> CalcUserSim[计算用户相似度]
    CalcUserSim --> FindKNN[找到K个最近邻用户]
    FindKNN --> GetCandidateItems[获取候选商品]
    
    ItemCF --> BuildItemMatrix[构建商品-用户矩阵]
    BuildItemMatrix --> CalcItemSim[计算商品相似度]
    CalcItemSim --> GetSimilarItems[获取相似商品]
    
    ContentBased --> ExtractFeatures[提取商品特征]
    ExtractFeatures --> BuildUserProfile[构建用户画像]
    BuildUserProfile --> MatchFeatures[特征匹配]
    
    GetCandidateItems --> Hybrid[混合推荐]
    GetSimilarItems --> Hybrid
    MatchFeatures --> Hybrid
    
    Hybrid --> WeightedFusion[加权融合]
    WeightedFusion --> ScoreItems[计算推荐得分]
    ScoreItems --> FilterItems[过滤已购买/已收藏]
    FilterItems --> SortItems[排序]
    SortItems --> TopN[取Top-N]
    TopN --> Return2[返回推荐结果]
    
    Return1 --> SaveLog[保存推荐日志]
    Return2 --> SaveLog
    SaveLog --> End([结束])
```

---

## 使用说明

### 方法1：使用VS Code + Mermaid插件
1. 安装VS Code插件：`Markdown Preview Mermaid Support`
2. 打开本文档，按 `Ctrl+Shift+V` 预览
3. 右键图表可导出为PNG或SVG

### 方法2：使用在线Mermaid编辑器
1. 访问 https://mermaid.live/
2. 复制上面的Mermaid代码
3. 粘贴到编辑器中
4. 点击"Download PNG"或"Download SVG"导出

### 方法3：使用PlantUML
1. 安装VS Code插件：`PlantUML`
2. 创建`.puml`文件
3. 复制PlantUML代码
4. 按 `Alt+D` 预览
5. 右键导出为图片

### 方法4：使用Draw.io
1. 访问 https://app.diagrams.net/
2. 选择对应的图表类型
3. 手动绘制或导入模板
4. 导出为PNG、PDF等格式

---

## 图表导出建议

### 论文中使用
- **格式**：PNG（高分辨率）或SVG（矢量图）
- **分辨率**：至少300 DPI
- **大小**：根据论文排版调整

### 演示使用
- **格式**：PNG或PDF
- **分辨率**：1920x1080或更高

---

## 注意事项

1. **ER图**：确保实体关系准确，外键关系清晰
2. **流程图**：保持逻辑清晰，避免交叉过多
3. **架构图**：层次分明，模块职责明确
4. **用例图**：角色和用例关系准确

如需调整图表内容，请修改对应的代码块即可。
